<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="generator" content="Hugo 0.18.1" />
	<meta name="viewport" content="width=device-width">
        <meta name="description" content="Hey! I&#39;m Ben. I&#39;m a deployment automation engineer living in Salt Lake City, Utah.">

	<title>Synchronizing A MySQL Database with Git and Git Hooks - Ben Kulbertis</title>

        <link rel="canonical" href="http://ben.kulbertis.org/2011/10/synchronizing-a-mysql-database-with-git-and-git-hooks">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>

	
	
	<meta name="theme-color" content="#222222">
	
	<meta name="msapplication-navbutton-color" content="#222222">

        
        <link href="//fonts.googleapis.com/css?family=Oswald" rel="stylesheet" type="text/css">
        <link href="//fonts.googleapis.com/css?family=Lato:400,900" rel="stylesheet" type="text/css">

        
        <link rel="stylesheet" href="/css/style.css">

        
        <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/history.js/1.8/native.history.min.js"></script>
        <script type="text/javascript" src="/js/main.js"></script>
        
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </head>
    <body>
        <header>
            <div id="headers">
                <h1><a href="http://ben.kulbertis.org">Ben Kulbertis</a></h1>
                <h2>Deployment Automation Engineer and Systems Administrator</h2>
                <h2>Salt Lake City, Utah, USA</h2>
            </div>
            <nav>
                <h4 id="blog-links-title">Write-ups</h4>
                <ul class="posts">
                    
                        <li>
    <a class="post-link" href="http://ben.kulbertis.org/2016/03/changes-in-mod-authz-unixgroup-from-apache-2-2-to-2-4">Changes in mod_authz_unixgroup from Apache 2.2 to 2.4</a>
    <small>&ndash; Mar 23, 2016</small>
</li>
                    
                        <li>
    <a class="post-link" href="http://ben.kulbertis.org/2011/10/synchronizing-a-mysql-database-with-git-and-git-hooks">Synchronizing A MySQL Database with Git and Git Hooks</a>
    <small>&ndash; Oct 29, 2011</small>
</li>
                    
                </ul>

                <div id="social">
                    <a href="http://github.com/benkulbertis">
                        <svg version="1.1" id="github" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                             width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">
                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#444444" d="M16,0.4c-8.8,0-16,7.2-16,16c0,7.1,4.6,13.1,10.9,15.2
                            c0.8,0.1,1.1-0.3,1.1-0.8c0-0.4,0-1.4,0-2.7c-4.5,1-5.4-2.1-5.4-2.1c-0.7-1.8-1.8-2.3-1.8-2.3c-1.5-1,0.1-1,0.1-1
                            c1.6,0.1,2.5,1.6,2.5,1.6c1.4,2.4,3.7,1.7,4.7,1.3c0.1-1,0.6-1.7,1-2.1c-3.6-0.4-7.3-1.8-7.3-7.9c0-1.7,0.6-3.2,1.6-4.3
                            c-0.2-0.4-0.7-2,0.2-4.2c0,0,1.3-0.4,4.4,1.6c1.3-0.4,2.6-0.5,4-0.5c1.4,0,2.7,0.2,4,0.5C23.1,6.6,24.4,7,24.4,7
                            c0.9,2.2,0.3,3.8,0.2,4.2c1,1.1,1.6,2.5,1.6,4.3c0,6.1-3.7,7.5-7.3,7.9c0.6,0.5,1.1,1.5,1.1,3c0,2.1,0,3.9,0,4.4
                            c0,0.4,0.3,0.9,1.1,0.8C27.4,29.5,32,23.5,32,16.4C32,7.6,24.8,0.4,16,0.4z"/>
                        </svg>
                    </a>
                    <a href="mailto:ben@kulbertis.org">
                        <svg id="email" fill="#FFFFFF" height="32" viewBox="0 0 24 24" width="32" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                            <path d="M0 0h24v24H0z" fill="none"/>
                        </svg>
                    </a>
                </div>
            </nav>
        </header>
        <section class="post">

<h3 id="post-title">Synchronizing A MySQL Database with Git and Git Hooks</h3>
<p class="meta">Oct 29, 2011</p>
<p>When I develop web based projects I often use a MySQL database to hold the data for my project. I also use git for source control and since I tend to work on my projects from several different computers I push and pull from a VPS of mine. This system works great for keeping all my source code in check and is easily accessible. However, I have had one issue. I was having to create a testing instance of my MySQL database on every computer that I pulled onto and worked from. This was a waste of time and also resulted in inconsistencies in my testing data which became confusing at times. I decided that I&rsquo;d had enough of this and set out to find a solution.</p>

<p>I found <a title="Backup Your Database in Git" href="http://www.viget.com/extend/backup-your-database-in-git/" target="_blank">an article by David Eisinger entitled &ldquo;Backup your Database in Git&rdquo;</a> in which he suggested using mysqldump and simply adding the dump to the database. While I had hoped for a more elegant solution than simply dumping your database every time, it would certainly work. He also suggested using cron to schedule dumps. David wrote this article describing a way to backup a production site, which cron would work fine for, but for me it would have to be a little more complicated as I wanted an updated database on every commit.</p>

<p>To automate the process of dumping and restoring my database dumps I decided that <a title="Git Hooks" href="http://book.git-scm.com/5_git_hooks.html" target="_blank">git hooks</a> would be able to do the job. I had recently worked with git hooks as a way to <a title="Automatically Deploying Website From Remote Git Repository" href="http://caiustheory.com/automatically-deploying-website-from-remote-git-repository" target="_blank">deploy website updates directly from a git database</a>. Using the pre-commit hook and the post-merge hook, we can create a system  that will automatically dump and add your database to each commit and update your local database from each pull.</p>

<p>Let&rsquo;s start with pre-commit. The pre-commit hook will run a script directly before a commit is executed. To edit your pre-commit hook:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">[</span>your editor<span style="color: #f92672">]</span> /path/to/your/repo/.git/hooks/pre-commit
</pre></div>


<p>Now, lets write the pre-commit script. We are going to tell the system to dump our MySQL database to our git repository and add it to be committed.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#!/bin/bash</span>
mysqldump -u <span style="color: #f92672">[</span>mysql user<span style="color: #f92672">]</span> -p<span style="color: #f92672">[</span>mysql password<span style="color: #f92672">]</span> --skip-extended-insert <span style="color: #f92672">[</span>database<span style="color: #f92672">]</span> &gt; /path/to/your/repo/<span style="color: #f92672">[</span>database<span style="color: #f92672">]</span>.sql
<span style="color: #f8f8f2">cd</span> /path/to/your/repo
git add <span style="color: #f92672">[</span>database<span style="color: #f92672">]</span>.sql
</pre></div>


<p>And mark the script executable.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>chmod +x /path/to/your/repo/.git/hooks/pre-commit
</pre></div>


<p>Now, lets write the post-merge script. We are going to tell the system to restore the MySQL dump to the local database for the latest changes. Edit the post-merge hook with:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">[</span>your editor<span style="color: #f92672">]</span> /path/to/your/repo/.git/hooks/post-merge
</pre></div>


<p>And write:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#!/bin/bash</span>
mysql -u <span style="color: #f92672">[</span>mysql user<span style="color: #f92672">]</span> -p<span style="color: #f92672">[</span>mysql password<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>database<span style="color: #f92672">]</span> &lt; /path/to/your/repo/<span style="color: #f92672">[</span>database<span style="color: #f92672">]</span>.sql
</pre></div>


<p><strong>Note that in both in the mysqldump and mysql commands, there is no space between the -p and the password.</strong></p>

<p>And let&rsquo;s mark this one executable too.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>chmod +x /path/to/your/repo/.git/hooks/post-merge
</pre></div>


<p>That is it! Now your MySQL database will be pushed and pulled with the rest of the commit and the pre-commit and post-merge hooks will handle the importing and exporting of the dumps.</p>

            </section>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-12745947-1', 'kulbertis.org');
            ga('send', 'pageview');
        </script>
    </body>
</html>