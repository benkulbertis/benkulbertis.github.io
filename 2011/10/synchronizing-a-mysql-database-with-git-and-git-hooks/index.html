<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Synchronizing A MySQL Database with Git and Git Hooks - Ben Kulbertis</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Hey! I&#39;m Ben. I&#39;m a young web developer living in Salt Lake City, Utah. I&#39;m currently interesting in writing web applications using Ember.js and Ruby on Rails.">
        <link rel="canonical" href="http://ben.kulbertis.org/2011/10/synchronizing-a-mysql-database-with-git-and-git-hooks">
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>

        
        <link href="//fonts.googleapis.com/css?family=Oswald" rel="stylesheet" type="text/css">
        <link href="//fonts.googleapis.com/css?family=Lato:400,900" rel="stylesheet" type="text/css">

        
        
        <link rel="stylesheet" href="/css/style.css">

        
        <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/history.js/1.8/native.history.min.js"></script>
        <script type="text/javascript" src="/js/main.js"></script>
        
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </head>
    <body>
        <header>
            <div id="headers">
                <h1><a href="http://ben.kulbertis.org">Ben Kulbertis</a></h1>
                <h2>Full Stack Web Developer and Technology Enthusiast</h2>
                <h2>Salt Lake City, Utah, USA</h2>
            </div>
            <nav>
                <h4 id="blog-links-title">Write-ups</h4>
                <ul class="posts">
                    
                        <li>
    <a class="post-link" href="http://ben.kulbertis.org/2011/10/synchronizing-a-mysql-database-with-git-and-git-hooks">Synchronizing A MySQL Database with Git and Git Hooks</a>
    <small>&ndash; Oct 29, 2011</small>
</li>
                    
                </ul>

                <div id="social">
                    <a href="https://twitter.com/benkulbertis" class="twitter-follow-button" data-show-count="true" data-lang="en">Follow @benkulbertis</a>
                    <iframe src="http://ghbtns.com/github-btn.html?user=benkulbertis&type=follow&count=true"
                            allowtransparency="true" frameborder="0" scrolling="0" width="165" height="20" class="github-follow-button"></iframe>
                </div>
            </nav>
        </header>
        <section class="post">
<h3 id="post-title">Synchronizing A MySQL Database with Git and Git Hooks</h3>
<p class="meta">Oct 29, 2011</p>
<p>When I develop web based projects I often use a MySQL database to hold the data for my project. I also use git for source control and since I tend to work on my projects from several different computers I push and pull from a VPS of mine. This system works great for keeping all my source code in check and is easily accessible. However, I have had one issue. I was having to create a testing instance of my MySQL database on every computer that I pulled onto and worked from. This was a waste of time and also resulted in inconsistencies in my testing data which became confusing at times. I decided that I&rsquo;d had enough of this and set out to find a solution.</p>

<p>I found <a title="Backup Your Database in Git" href="http://www.viget.com/extend/backup-your-database-in-git/" target="_blank">an article by David Eisinger entitled &ldquo;Backup your Database in Git&rdquo;</a> in which he suggested using mysqldump and simply adding the dump to the database. While I had hoped for a more elegant solution than simply dumping your database every time, it would certainly work. He also suggested using cron to schedule dumps. David wrote this article describing a way to backup a production site, which cron would work fine for, but for me it would have to be a little more complicated as I wanted an updated database on every commit.</p>

<p>To automate the process of dumping and restoring my database dumps I decided that <a title="Git Hooks" href="http://book.git-scm.com/5_git_hooks.html" target="_blank">git hooks</a> would be able to do the job. I had recently worked with git hooks as a way to <a title="Automatically Deploying Website From Remote Git Repository" href="http://caiustheory.com/automatically-deploying-website-from-remote-git-repository" target="_blank">deploy website updates directly from a git database</a>. Using the pre-commit hook and the post-merge hook, we can create a system  that will automatically dump and add your database to each commit and update your local database from each pull.</p>

<p>Let&rsquo;s start with pre-commit. The pre-commit hook will run a script directly before a commit is executed. To edit your pre-commit hook:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">[</span>your editor<span style="color: #f92672">]</span> /path/to/your/repo/.git/hooks/pre-commit
</pre></div>


<p>Now, lets write the pre-commit script. We are going to tell the system to dump our MySQL database to our git repository and add it to be committed.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/bin/bash</span>
mysqldump -u <span style="color: #f92672">[</span>mysql user<span style="color: #f92672">]</span> -p<span style="color: #f92672">[</span>mysql password<span style="color: #f92672">]</span> --skip-extended-insert <span style="color: #f92672">[</span>database<span style="color: #f92672">]</span> &gt; /path/to/your/repo/<span style="color: #f92672">[</span>database<span style="color: #f92672">]</span>.sql
<span style="color: #f8f8f2">cd</span> /path/to/your/repo
git add <span style="color: #f92672">[</span>database<span style="color: #f92672">]</span>.sql
</pre></div>


<p>And mark the script executable.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">chmod +x /path/to/your/repo/.git/hooks/pre-commit
</pre></div>
</p>

<p>Now, lets write the post-merge script. We are going to tell the system to restore the MySQL dump to the local database for the latest changes. Edit the post-merge hook with:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">[</span>your editor<span style="color: #f92672">]</span> /path/to/your/repo/.git/hooks/post-merge
</pre></div>
</p>

<p>And write:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #75715e">#!/bin/bash</span>
mysql -u <span style="color: #f92672">[</span>mysql user<span style="color: #f92672">]</span> -p<span style="color: #f92672">[</span>mysql password<span style="color: #f92672">]</span> <span style="color: #f92672">[</span>database<span style="color: #f92672">]</span> &lt; /path/to/your/repo/<span style="color: #f92672">[</span>database<span style="color: #f92672">]</span>.sql
</pre></div>
</p>

<p><strong>Note that in both in the mysqldump and mysql commands, there is no space between the -p and the password.</strong></p>

<p>And let&rsquo;s mark this one executable too.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">chmod +x /path/to/your/repo/.git/hooks/post-merge
</pre></div>
</p>

<p>That is it! Now your MySQL database will be pushed and pulled with the rest of the commit and the pre-commit and post-merge hooks will handle the importing and exporting of the dumps.</p>

            </section>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-12745947-1', 'kulbertis.org');
            ga('send', 'pageview');
        </script>
    </body>
</html>